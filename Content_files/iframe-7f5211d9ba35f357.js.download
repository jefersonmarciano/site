(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1777],{23544:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/widget/[id]/iframe",function(){return r(4083)}])},18483:function(e,t,r){"use strict";r.d(t,{A:function(){return h}});var s=r(85893),n=r(74708),a=r(4855),l=r(67294),i=r(51649),o=r(60155),c=r(55299),d=r(1735),u=r(97762),m=r(43334);let h=e=>{let{allow:t,config:r,userUid:h,initialConversation:f,fullScreen:x}=e,g=f.length>0&&f.length>=50,p=(0,l.useRef)(),v=(0,l.useRef)(null),w=(0,l.useRef)(null),[y,j]=(0,l.useState)(!1),[b,N]=(0,l.useState)(f.length?f:[{role:"assistant",content:r.initialMessage,images:[]}]),[k,E]=(0,l.useState)(""),T=(0,a.h)(),[S,C]=(0,l.useState)(!1),[M,_]=(0,l.useState)(null),[D]=(0,l.useState)(n.S.generate()),{t:H}=(0,m.m)();(0,l.useEffect)(()=>{if(!x){var e=[...b];e[0].content=r.initialMessage,N(e)}},[r.initialMessage]);let I=e=>{var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));v.current&&(v.current.scrollLeft-=40*t),e.preventDefault()};(0,l.useEffect)(()=>{if(v.current)return v.current.addEventListener("wheel",I),()=>{v.current&&v.current.removeEventListener("wheel",I)}},[v.current]),(0,l.useEffect)(()=>{w.current&&A()},[w.current]);let L=e=>{let t=e.target;p.current.style.height="44px",p.current.style.height="".concat(t.scrollHeight,"px")},A=()=>{w.current.scroll({top:w.current.scrollHeight,behavior:"smooth"})},B=async e=>{let t=e||k;if(!y&&t&&t.trim()){if(N(e=>[...e,{role:"user",content:t,images:[]}]),!x){E(""),setTimeout(()=>{A()});return}j(!0),p&&p.current&&(p.current.style.height="44px"),E(""),setTimeout(()=>{A()});try{let e=await T.conversation(r.assistantId,{message:t,userUid:h,messageId:n.S.generateAlt()});N(t=>[...t,e])}catch(e){if(j(!1),e.response.data.includes("NO_CREDITS")){N(e=>[...e,{fromMe:!1,text:"NO_CREDITS"}]);return}N(e=>[...e,{role:"assistant",content:"Tive uns problemas t\xe9cnicos, pode repetir por favor?",images:[]}])}j(!1),setTimeout(()=>{A()})}},U=()=>{window.parent.postMessage({type:"gpt-maker-button-close"},"*")},O=e=>{let t=(0,s.jsx)(c.D,{linkTarget:"_blank",children:e}),r=u.renderToStaticMarkup(t),n=(0,d.B)(r);return n};return t?(0,s.jsxs)("div",{className:"".concat(x?"min-h-screen max-h-screen":"min-h-full max-h-full"," flex flex-col w-full overflow-hidden"),children:[(0,s.jsxs)("div",{style:{minHeight:"4rem",background:r.headerBackground,color:r.headerColor},className:"h-16 items-center flex px-6",children:[(0,s.jsx)("img",{src:r.avatar,alt:r.name,className:"w-10 h-10 rounded-full"}),(0,s.jsx)("span",{className:"block ml-3 flex-1",children:r.name}),!x&&(0,s.jsx)("button",{type:"button",className:"mr-4",onClick:()=>{N([{role:"assistant",content:r.initialMessage,images:[]}])},children:(0,s.jsx)(o._Kc,{size:20})}),(0,s.jsx)("button",{type:"button",onClick:U,children:(0,s.jsx)(i.QAE,{size:24})})]}),(0,s.jsxs)("div",{className:"flex-1 px-6 py-6 overflow-auto",ref:w,children:[g&&(0,s.jsx)("div",{className:"text-sm text-gray-400 text-center justify-center mb-8",children:H("components.chat-widget.interactions.limit")}),b.map((e,t)=>(0,s.jsx)("div",{className:"user"==e.role?"flex justify-end ml-8":"flex justify-start mr-8",children:(0,s.jsxs)("div",{style:"user"==e.role?{background:r.messageUserBackground,color:"white"}:{background:"#f1f1f0",color:"black"},className:"overflow-auto max-w-prose mb-3 rounded-lg py-3 px-4",children:[e.images&&e.images.length>0&&(0,s.jsx)(s.Fragment,{children:e.images.map((e,t)=>(0,s.jsx)("img",{src:e,className:"w-full rounded-md mb-2",onLoad:()=>{w.current&&w.current.scroll({top:w.current.scrollHeight,behavior:"smooth"})}},t))}),(0,s.jsx)("div",{className:"flex flex-col items-start gap-4 break-words",children:(0,s.jsx)("div",{className:"prose text-inherit text-left w-full break-words dark:prose-invert ",children:(0,s.jsx)("pre",{className:"text-sm message-markdown",style:{whiteSpace:"pre-line",overflowWrap:"anywhere"},children:"NO_CREDITS"===e.text?(0,s.jsx)("span",{className:"italic",children:H("components.chat-widget.noCredits")}):(0,s.jsx)("span",{dangerouslySetInnerHTML:{__html:O(e.content)}})})})})]})},t)),!x&&(0,s.jsx)("div",{className:"my-4 text-center w-full text-xs",children:(0,s.jsx)("span",{children:H("components.chat-widget.preview.feedback")})}),y&&(0,s.jsx)("div",{style:{minHeight:"2.75rem"},className:"h-11 bg-slate-200 w-fit text-gray-700 rounded-lg mb-4 mt-2 flex items-center px-8",children:(0,s.jsx)("div",{className:"dot-pulse"})})]}),!f.length&&1==b.length&&r.suggestMessages&&r.suggestMessages.length>0&&(0,s.jsx)("div",{ref:v,className:"suggest-messages w-full h-12 mb-2 flex flex-row items-center px-6 overflow-x-auto overflow-y-hidden",children:r.suggestMessages.map((e,t)=>(0,s.jsx)("button",{type:"button",onClick:()=>{B(e)},className:"bg-gray-100 hover:bg-gray-200 text-xs cursor-pointer rounded-full px-4 py-2 mr-2 min-w-fit",children:(0,s.jsx)("span",{children:e})},t))}),(0,s.jsxs)("div",{className:"border-t border-solid border-gray-200 flex flex-row",children:[(0,s.jsx)("div",{className:"flex-1 ",children:(0,s.jsx)("textarea",{ref:p,className:"resize-none rounded-md px-6 py-2 mt-2 w-full outline-none",required:!0,placeholder:H("components.chat-widget.input.placeholder.feedback"),name:"affirmation",disabled:!1,value:k,maxLength:1028,style:{height:44},onKeyDown:e=>{e.shiftKey||"Enter"!=e.key||(e.preventDefault(),e.stopPropagation(),B())},onChange:e=>{E(e.target.value),L(e)}})}),(0,s.jsx)("div",{style:{height:58},className:"px-4 flex items-center justify-center",children:(0,s.jsx)("button",{type:"button",onClick:()=>B(),children:(0,s.jsx)(o.yhK,{})})})]})]}):(0,s.jsx)("div",{className:"min-h-screen text-gray-600 px-4 flex flex-col w-full items-center justify-center",children:(0,s.jsx)("span",{children:"Chat n\xe3o habilitado para esse dom\xednio."})})}},1735:function(e,t,r){"use strict";r.d(t,{B:function(){return l}});var s=r(68337),n=r.n(s);let a=n()();function l(e){if("undefined"==typeof DOMParser)return e;for(var t=new DOMParser().parseFromString(e,"text/html"),r=t.body.getElementsByTagName("*"),s=0;s<r.length;s++){var n=r[s];if("a"!==n.tagName.toLowerCase())for(var l=n.childNodes,i=0;i<l.length;i++){var o=l[i];if(o.nodeType===Node.TEXT_NODE){var c=a.match(o.textContent);if(c)for(var d=0;d<c.length;d++){var u=c[d],m=t.createElement("a");m.setAttribute("href",u.url),m.setAttribute("target","_blank"),m.setAttribute("rel","noopener noreferrer"),m.textContent=u.raw;var h=o.textContent.split(u.raw),f=h[0],x=h[1];o.parentNode&&(o.parentNode.insertBefore(document.createTextNode(f),o),o.parentNode.insertBefore(m,o),o.parentNode.insertBefore(document.createTextNode(x),o),o.parentNode.removeChild(o))}}}}return t.body.innerHTML}},4083:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSP:function(){return w},default:function(){return y}});var s=r(85893),n=r(18483),a=r(4855),l=r(67294),i=r(51649),o=r(60155),c=r(55299),d=r(1735),u=r(97762),m=r(43334),h=r(61899);let f=e=>{let{allow:t,config:r,userUid:n,initialConversation:f,fullScreen:x}=e,g=f.length>0&&f.length>=50,p=(0,l.useRef)(),v=(0,l.useRef)(null),w=(0,l.useRef)(null),[y,j]=(0,l.useState)(0),[b,N]=(0,l.useState)(!1),[k,E]=(0,l.useState)(f.length?f:[{role:"assistant",type:"TEXT",text:r.initialMessage}]),[T,S]=(0,l.useState)(""),[C,M]=(0,l.useState)(""),_=(0,a.h)(),{t:D}=(0,m.m)(),{openWidgetSocket:H,onNewMessageEventRef:I}=(0,h.f)(),L=e=>{e.eventName&&N(!0),e.type&&(N(!1),E(t=>[...t,e]),setTimeout(()=>{U()}))};(0,l.useEffect)(()=>{w.current.scroll({top:w.current.scrollHeight})},[b]),(0,l.useEffect)(()=>{window.onUpdateChat=L},[L]),(0,l.useEffect)(()=>{H&&H(n),I.current=e=>{window.onUpdateChat(e)}},[n]),(0,l.useEffect)(()=>{if(!x){var e=[...k];e[0].content=r.initialMessage,E(e)}},[r.initialMessage]);let A=e=>{var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));v.current&&(v.current.scrollLeft-=40*t),e.preventDefault()};(0,l.useEffect)(()=>{if(v.current)return v.current.addEventListener("wheel",A),()=>{v.current&&v.current.removeEventListener("wheel",A)}},[v.current]),(0,l.useEffect)(()=>{w.current&&U()},[w.current]);let B=e=>{let t=e.target;p.current.style.height="44px",p.current.style.height="".concat(t.scrollHeight,"px")},U=()=>{w.current.scroll({top:w.current.scrollHeight,behavior:"smooth"})},O=async e=>{let t=e||C;if(b||!t||!t.trim())return;let s={assistantId:r.assistantId,recipient:n,role:"user",...T?{imageCaption:t,image:T}:{text:t}};E(e=>[...e,s]),p&&p.current&&(p.current.style.height="44px"),M(""),setTimeout(()=>{U()}),await _.conversationV2(r.assistantId,s),setTimeout(()=>{U()})},R=()=>{window.parent.postMessage({type:"gpt-maker-button-close"},"*")},K=e=>{let t=(0,s.jsx)(c.D,{linkTarget:"_blank",children:e}),r=u.renderToStaticMarkup(t),n=(0,d.B)(r);return n},P=e=>{e.target.scrollTop+e.target.clientHeight>=e.target.scrollHeight&&j(e.target.scrollHeight)};return t?(0,s.jsxs)("div",{className:"".concat(x?"min-h-screen max-h-screen":"min-h-full max-h-full"," flex flex-col w-full overflow-hidden"),children:[(0,s.jsxs)("div",{style:{minHeight:"4rem",background:r.headerBackground,color:r.headerColor},className:"h-16 items-center flex px-6",children:[(0,s.jsx)("img",{src:r.avatar,alt:r.name,className:"w-10 h-10 rounded-full"}),(0,s.jsx)("span",{className:"block ml-3 flex-1",children:r.name}),!x&&(0,s.jsx)("button",{type:"button",className:"mr-4",onClick:()=>{E([{role:"assistant",type:"TEXT",text:r.initialMessage}])},children:(0,s.jsx)(o._Kc,{size:20})}),(0,s.jsx)("button",{type:"button",onClick:R,children:(0,s.jsx)(i.QAE,{size:24})})]}),(0,s.jsxs)("div",{className:"flex-1 px-6 py-6 overflow-auto",ref:w,onScroll:P,children:[g&&(0,s.jsx)("div",{className:"text-sm text-gray-400 text-center justify-center mb-8",children:D("components.chat-widget.interactions.limit")}),k.map((e,t)=>(0,s.jsx)("div",{className:"user"==e.role?"flex justify-end ml-8":"flex justify-start mr-8",children:(0,s.jsx)("div",{style:"user"==e.role?{background:r.messageUserBackground,color:"white"}:{background:"#f1f1f0",color:"black"},className:"overflow-auto max-w-prose mb-3 rounded-lg py-3 px-4",children:(0,s.jsxs)("div",{className:"w-full",children:["IMAGE"==e.type&&(0,s.jsx)("img",{src:e.imageUrl,className:"rounded-md mb-2",onLoad:()=>{(!y||w.current&&w.current.scrollTop+w.current.clientHeight===y)&&w.current.scroll({top:w.current.scrollHeight})}},t),"DOCUMENT"==e.type&&(0,s.jsx)("iframe",{src:e.documentUrl,className:"rounded-md mb-2"},t),"AUDIO"==e.type&&(0,s.jsx)("audio",{controls:!0,src:e.audioUrl,className:"rounded-md mb-2"}),e.text&&(0,s.jsx)("span",{dangerouslySetInnerHTML:{__html:K(e.text)}})]})})},t)),!x&&(0,s.jsx)("div",{className:"my-4 text-center w-full text-xs",children:(0,s.jsx)("span",{children:D("components.chat-widget.preview.feedback")})}),b&&(0,s.jsx)("div",{style:{minHeight:"2.75rem"},className:"h-11 bg-slate-200 w-fit text-gray-700 rounded-lg mb-4 mt-2 flex items-center px-8",children:(0,s.jsx)("div",{className:"dot-pulse"})})]}),!f.length&&1==k.length&&r.suggestMessages&&r.suggestMessages.length>0&&(0,s.jsx)("div",{ref:v,className:"suggest-messages w-full h-12 mb-2 flex flex-row items-center px-6 overflow-x-auto overflow-y-hidden",children:r.suggestMessages.map((e,t)=>(0,s.jsx)("button",{type:"button",onClick:()=>{O(e)},className:"bg-gray-100 hover:bg-gray-200 text-xs cursor-pointer rounded-full px-4 py-2 mr-2 min-w-fit",children:(0,s.jsx)("span",{children:e})},t))}),(0,s.jsxs)("div",{className:"border-t border-solid border-gray-200 flex flex-row",children:[(0,s.jsx)("div",{className:"flex-1 ",children:(0,s.jsx)("textarea",{ref:p,className:"resize-none rounded-md px-6 py-2 mt-2 w-full outline-none",required:!0,placeholder:D("components.chat-widget.input.placeholder.feedback"),name:"affirmation",disabled:!1,value:C,maxLength:1028,style:{height:44},onKeyDown:e=>{e.shiftKey||"Enter"!=e.key||(e.preventDefault(),e.stopPropagation(),O())},onChange:e=>{M(e.target.value),B(e)}})}),(0,s.jsx)("div",{style:{height:58},className:"px-4 flex items-center justify-center",children:(0,s.jsx)("button",{type:"button",onClick:()=>O(),children:(0,s.jsx)(o.yhK,{})})})]})]}):(0,s.jsx)("div",{className:"min-h-screen text-gray-600 px-4 flex flex-col w-full items-center justify-center",children:(0,s.jsx)("span",{children:"Chat n\xe3o habilitado para esse dom\xednio."})})};var x=r(78841),g=r(74708),p=r(6154);let v=e=>{let{allow:t,config:r}=e,[a,i]=(0,l.useState)(""),[o,c]=(0,l.useState)(null),d=async e=>{if(r.beta){let t=await p.Z.get("".concat(x._.api,"/widget/").concat(r.token,"/load-conversation-v2/").concat(e)).then(e=>e.data);c(t)}else{let t=await p.Z.get("".concat(x._.api,"/widget/").concat(r.token,"/load-conversation/").concat(e)).then(e=>e.data);c(t)}};return((0,l.useEffect)(()=>{let e=localStorage.getItem("".concat(r.assistantId,"-user-id"));e||(e=g.S.generateAlt(),localStorage.setItem("".concat(r.assistantId,"-user-id"),e)),i(e),d(e)},[]),a&&o)?r.beta?(0,s.jsx)(f,{allow:t,config:r,fullScreen:!0,userUid:a,initialConversation:o}):(0,s.jsx)(n.A,{allow:t,config:r,fullScreen:!0,userUid:a,initialConversation:o}):(0,s.jsx)("div",{})};var w=!0,y=v},4855:function(e,t,r){"use strict";r.d(t,{h:function(){return n}});var s=r(61227);let n=()=>{let e=(0,s.i)();return{save:(t,r)=>e.put("/widget/".concat(t,"/save-widget-config"),r).then(e=>e.data),renewToken:t=>e.get("/widget/".concat(t,"/renew-token")).then(e=>e.data),conversationV2:(t,r)=>e.post("/widget/".concat(t,"/conversation-v2"),r).then(e=>e.data),conversation:(t,r)=>e.post("/widget/".concat(t,"/conversation"),r).then(e=>e.data)}}}},function(e){e.O(0,[9774,9866,260,5907,2888,179],function(){return e(e.s=23544)}),_N_E=e.O()}]);